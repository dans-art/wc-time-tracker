var swRegistration=null;function get_products(orderid){var data={action:"get_products",orderid:orderid};jQuery.post(da_ajaxurl,data,(function(response){var items=JSON.parse(response);items.error.length>0?(tt_log(items.error),hide_product_dropdown()):(jQuery("#tt_customer_products_select").html(items.success),show_product_dropdown(),jQuery("#tt_customer_products_select").change((function(e){if("link"===jQuery(this).find(":selected").val()){var url=wp_backend_url+jQuery("#tt_customer_select").find(":selected").val(),win=window.open(url,"_blank");hide_product_dropdown(),jQuery("#tt_customer_select > option:eq(0)").attr("selected",!0),win.focus()}else if("null"!==jQuery(this).find(":selected").val()){var qty;show_time_tracker(jQuery(this).find(":selected").attr("data-current_qty"))}else hide_time_tracker()})))}))}function save_product(qty){var order_item_id,meta_date,meta_description,data={action:"save_qty",order_item_id:jQuery("#tt_customer_products_select").find(":selected").val(),qty:qty,meta_date:jQuery("#tt_start_time").attr("stime"),meta_description:jQuery("#tt_meta_description").val()};jQuery.post(da_ajaxurl,data,(function(response){var items=JSON.parse(response),orderid;items.error.length>0?tt_log(items.error,"error"):(tt_log(items.success,"success"),get_products(jQuery("#tt_customer_select").find(":selected").val()),hide_time_tracker())}))}function show_time_tracker(qty){jQuery("#tt_timetracker").show(),jQuery("#tt_start_value .value").html(qty)}function hide_time_tracker(){jQuery("#tt_timetracker").hide()}function show_product_dropdown(){jQuery("#tt_customer_products").show()}function hide_product_dropdown(){jQuery("#tt_customer_products").hide()}function time_tracker_click(btn){var ctext;"Start"===jQuery(btn).text()?(jQuery(btn).text("Stop"),run_time_tracker()):(jQuery(btn).text("Start"),stop_time_tracker())}function run_time_tracker(){jQuery("#tt_customer_select").attr("disabled",!0),jQuery("#tt_customer_products_select").attr("disabled",!0);var date=(new Date).toLocaleDateString("de-DE"),time=(new Date).toLocaleTimeString("de-DE"),time_in_seconds=(new Date).getTime();jQuery("#tt_start_time").attr("stime",time_in_seconds),jQuery("#tt_start_time .value").html(date+" - "+time),jQuery("#tt_stop_time .value").html(""),showLocalNotification("Time Tracker","Tracking started for "+get_current_customer_name(),"starttt");var ct=null;document.tt_timer=window.setInterval((function(){ct=time_tracker_current()}),1e3),document.tt_timer_notification=window.setInterval((function(){showLocalNotification("Time Tracker","Tracking still running for "+get_current_customer_name()+"\r\nCurrent time: "+ct,"starttt")}),18e5)}function stop_time_tracker(){closeLocalNotification("starttt"),jQuery("#tt_customer_select").attr("disabled",!1),jQuery("#tt_customer_products_select").attr("disabled",!1);var date=(new Date).toLocaleDateString("de-DE"),time=(new Date).toLocaleTimeString("de-DE");jQuery("#tt_stop_time .value").html(date+" - "+time);var otime=jQuery("#tt_start_time").attr("stime"),ctime=(new Date).getTime();clearInterval(document.tt_timer),clearInterval(document.tt_timer_notification);var calcTime=ctime-otime;time_tracker_current();var hrs=parseFloat(ms_to_hours(calcTime)),oqty,qty_to_save;0===hrs&&(hrs=.1),save_product(hrs+parseFloat(jQuery("#tt_start_value .value").html()))}function time_tracker_current(){var otime=jQuery("#tt_start_time").attr("stime"),ctime,calcTime=(new Date).getTime()-otime,hrs=parseFloat(ms_to_hours(calcTime)),ct=ms_to_time(calcTime)+" ("+hrs+"h)";return jQuery("#tt_current_time .value").html(ct),ct}function ms_to_time(s){var ms,secs=(s=(s-s%1e3)/1e3)%60,mins=(s=(s-secs)/60)%60,hrs;return pad((s-mins)/60)+":"+pad(mins)+":"+pad(secs)}function ms_to_hours(s){var ms,secs,mins=(s=((s=(s-s%1e3)/1e3)-s%60)/60)%60,hrs,calcT=(s-mins)/60+mins/60;return(Math.round(100*calcT)/100).toFixed(1)}function pad(n,z=2){return("00"+n).slice(-z)}function tt_log(msg,type){jQuery("#tt_log").append('<span class="'+type+'">'+msg+"</span><br/>")}function get_current_customer_name(){var selector=jQuery("#tt_customer_select").find(":selected"),company,name;return selector.attr("data-company")+" - "+selector.attr("data-name")}jQuery(document).ready((function($){$("#tt_customer_select").change((function(){"null"!==$(this).find(":selected").val()&&(jQuery("#tt_customer_products_select").html(""),hide_time_tracker(),hide_product_dropdown(),get_products($(this).val()))})),jQuery("#tt_action_button").click((function(btn){time_tracker_click(this)})),init_push_notifications()}));const showLocalNotification=(title,body,thetag="default")=>{dataobj=new Object,dataobj.url=window.location.href;const options={body:body,tag:thetag,icon:wp_frontend_url+"include/images/icon.ico",badge:wp_frontend_url+"include/images/icon.ico",vibrate:[10,50,50,50,10],data:dataobj};var not;return swRegistration.showNotification(title,options)};function closeLocalNotification(thetag){swRegistration.getNotifications({tag:thetag}).then((function(notifications){notifications.forEach(notification=>notification.close())}))}const init_push_notifications=async()=>{check(),swRegistration=await registerServiceWorker();const permission=await requestNotificationPermission()},check=()=>{if(!("serviceWorker"in navigator))throw new Error("No Service Worker support!");if(!("PushManager"in window))throw new Error("No Push API Support!")},registerServiceWorker=async()=>{const swRegistration=await navigator.serviceWorker.register(wp_frontend_url+"include/scripts/tt-push-service.min.js");return swRegistration},requestNotificationPermission=async()=>{const permission=await window.Notification.requestPermission();if("granted"!==permission)throw new Error("Permission not granted for Notification")};